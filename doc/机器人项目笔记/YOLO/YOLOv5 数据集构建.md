# YOLOv5 数据集构建

## 一、数据收集核心要点

数据收集是数据集构建的前提，需覆盖目标场景的多样性，确保模型泛化能力。实操中主要分为图片和视频两种数据类型，适配不同原始数据场景。

- **图片类型数据**：若直接获取图片（如网络爬取、相机拍摄），可直接用于后续标注，无需额外预处理。需注意图片分辨率适中，目标物体清晰，避免模糊、过度曝光等问题，同时保证图片数量覆盖不同角度、光线环境。

- **视频类型数据**：若仅拥有视频素材，可通过 OpenCV 工具进行抽帧处理，将视频转化为连续图片。该方式能快速扩充数据集规模，尤其适合动态场景的数据收集（如实操中“死神VS火影”视频案例）。

关键原则：无论哪种数据类型，最终需将所有图片统一存放至指定文件夹（如 `images`），确保路径纯英文无空格，便于后续工具调用。

## 二、OpenCV 视频抽帧实操

本章节以 40 秒左右的视频为例，演示如何通过 OpenCV 提取图片帧，解决颜色异常问题，并设置间隔帧减少冗余图片。

### 1. 前期准备

1. 环境确认：确保已在 yolov5 虚拟环境中安装 OpenCV，若未安装可执行命令：
        `pip install opencv-python matplotlib`
        （matplotlib 用于图片可视化，辅助调试抽帧效果）
    
2. 文件夹创建：新建名为 `images` 的文件夹，用于存放提取后的图片，建议与视频文件同级目录，便于路径管理。

### 2. 基础抽帧代码（含颜色校正）

OpenCV 读取视频默认采用 BGR 颜色通道，直接显示会出现颜色异常，需转换为 RGB 通道才能正常可视化。

```Python

# 导入依赖库
import cv2
import matplotlib.pyplot as plt

# 打开视频文件（替换为自己的视频路径）
video = cv2.VideoCapture("./BVN.mp4")

# 读取一帧视频
ret, frame = video.read()

# 颜色通道转换：BGR → RGB（解决颜色异常问题）
plt.imshow(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))
```

#### 代码关键说明

- `cv2.VideoCapture()`：传入视频路径，创建视频读取对象，路径支持绝对路径（如 `C:/data/video.mp4`）和相对路径。

- `ret` 与 `frame`：`ret` 为布尔值，`True` 表示读取成功，`False` 表示视频读取结束；`frame` 为当前帧的图像数据。

- `cv2.cvtColor()`：核心颜色转换函数，`cv2.COLOR_BGR2RGB` 为转换参数，确保图片显示颜色与原始视频一致。

### 3. 完整抽帧代码（间隔帧设置）

视频帧速率通常为 30 帧/秒，直接抽帧会生成大量冗余图片，实操中设置间隔帧（如每隔 30 帧保存一张），平衡数据集规模与多样性。

```Python

video=cv2.VideoCapture("./BVN.mp4")
num=0
save_step=30
while True:
    ret, frame = video.read()
    if not ret:
        break
    num += 1
    if num % save_step == 0:
        cv2.imwrite("./images/"+str(num)+".jpg", frame)
```

#### 实操验证

执行代码后，打开 `images` 文件夹，可看到按间隔帧保存的图片（如 30.jpg、60.jpg、90.jpg），说明抽帧逻辑正常。若需调整图片数量，可修改 `save_step` 参数（值越大，保存图片越少；值越小，保存图片越密集）。

## 三、LabelImg 标注工具安装与使用

LabelImg 是一款轻量型可视化标注工具，支持 YOLO 格式标注文件生成，操作简单且适配 YOLOv5 模型需求，无需源码编译，可直接通过 pip 安装。

### 1. 工具安装（yolov5 环境适配）

1. 打开 CMD，激活 yolov5 虚拟环境：
        `conda a` `ctivate yolov5`

2. 执行安装命令，自动下载并安装 LabelImg：
        `pip install labelimg`说明：无需遵循官网源码编译流程，pip 安装可直接完成环境集成，国内源（前文配置的清华源）可加速下载。
    

### 2. 工具启动与基础设置

#### 启动步骤

1. 在激活的 yolov5 环境中，直接输入命令启动 LabelImg：
        `labelimg`

2. 启动后将弹出标注窗口，需完成两项核心设置：

    - **选择图片文件夹**：点击顶部「Open Dir」，选择前文抽帧后的 `images` 文件夹，加载所有待标注图片。

    - **选择标注结果保存文件夹**：点击顶部「Change Save Dir」，新建并选择 `labels` 文件夹（与 `images` 同级），用于存放标注生成的 TXT 文件。

    - **切换标注格式**：点击顶部「Save」下拉菜单，将格式从默认的「PascalVOC」切换为「YOLO」，确保生成的标注文件适配 YOLOv5。

    - **开启自动保存**：勾选顶部「View」→「Auto Save Mode」，标注完成后自动保存，无需手动点击保存按钮。

### 3. 标注实操流程（以“daitu”“mingren”标注为例）

1. **创建标注框**：

    - 快捷键`W`：快速创建矩形标注框（或右键选择「Create RectBox」）。

    - 拖动鼠标框选图片中的目标物体（如“daitu”），松开后弹出标签输入框，输入目标类别名称（如“daitu”），点击「OK」完成单个目标标注。

2. **多目标标注**：重复步骤 1，框选图片中的其他目标（如“mingren”），输入对应类别名称，完成单张图片全目标标注。

3. **批量标注**：

    - 快捷键 `D`：切换至下一张图片。

    - 快捷键 `A`：切换至上一张图片，便于修改标注内容。

    - 按上述流程逐张标注，标注过程中可通过「View」→「Display Labels」查看已标注框，校验标注准确性。

### 4. 标注结果解析

批量标注完成后，打开 `labels` 文件夹，将生成两类文件，与 `images`文件夹中的图片一一对应，为后续模型训练提供数据支撑。

- 第一列（0/1）：类别索引，对应 `classes.txt` 中的类别顺序（0 为“daitu”，1 为“mingren”）。

- **TXT 标注文件**：
        每个图片对应一个同名 TXT 文件，文件内容格式如下（以“daitu”和“mingren”为例）

- **classes.txt 文件**：自动生成的类别清单，记录所有标注类别名称（如“daitu”“mingren”），顺序与 TXT 文件中的类别索引对应，不可随意修改顺序。